- Decision: NotABug
- Reason: The reported code does not match the target bug pattern and does not present a real bug. In fsverity_init_merkle_tree_params(), the shared error label out_err frees params->hashstate. Ownership of hashstate is with this function/caller: it is set from fsverity_prepare_hash_state(), which returns either a newly allocated pointer or an ERR_PTR; it does not free anything on failure. When fsverity_prepare_hash_state() fails, the code explicitly sets params->hashstate = NULL before goto out_err, so kfree(NULL) is safe. In other error paths (after a successful allocation), freeing params->hashstate at out_err prevents a leak and is correct. Additionally, the caller (fsverity_create_info) frees vi->tree_params.hashstate only on its own failure path, and since fsverity_init_merkle_tree_params() zeroes params via memset(params, 0, ...) at out_err, the subsequent kfree() in the caller sees NULL and is also safe. There is no scenario where callee-managed memory is freed unconditionally leading to double free, unlike the target pattern.
